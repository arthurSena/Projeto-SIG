
<html>
	<head>
		<title>Projeto-SIG 2015.1</title>

		
		<script src="http://openlayers.org/api/OpenLayers.js"></script>

		
	</head>

	<script type="text/javascript">

	OpenLayers.ProxyHost = "proxy.cgi?url=";

	OpenLayers.Control.Click = OpenLayers.Class(OpenLayers.Control, {                
        defaultHandlerOptions: {
            'single': true,
            'double': false,
            'pixelTolerance': 0,
            'stopSingle': false,
            'stopDouble': false
        },

        initialize: function(options) {
            this.handlerOptions = OpenLayers.Util.extend(
                {}, this.defaultHandlerOptions
            );
            OpenLayers.Control.prototype.initialize.apply(
                this, arguments
            ); 
            this.handler = new OpenLayers.Handler.Click(
                this, {
                    'click': this.trigger
                }, this.handlerOptions
            );
        }, 

        trigger: function(e) {
            var lonlat = map.getLonLatFromPixel(e.xy);
			document.getElementById("click").innerHTML = "Coordenadas " + lonlat.lat + " N, " +
                                      + lonlat.lon + " E";
            alert("Coordenadas " + lonlat.lat + " N, " +
                                      + lonlat.lon + " E");
        }

    });
    
    
	var map;
	var highlightLayer;
	var infoControls;
	function init(){

		map = new OpenLayers.Map('map',{
		projection:'EPSG:4326'
		});

		var osm = new OpenLayers.Layer.OSM();

		var bairros_cg = new OpenLayers.Layer.WMS(
			"Bairros", "http://localhost:8080/geoserver/nurc/wms",
			{layers: 'nurc:campina_bairros', transparent: "true"},
			{singleTile: false, isBaseLayer: false, displayOutsideMaxExtent : true, visibility: false, yx : {'EPSG:5535' : true}}
		);
		
		var pontos = new OpenLayers.Layer.WMS(
			"Pontos", "http://localhost:8080/geoserver/nurc/wms",
			{layers: 'nurc:pontos', transparent: "true"},
			{singleTile: false, isBaseLayer: false, displayOutsideMaxExtent : true, visibility: false, yx : {'EPSG:4326' : true}}
		);

		highlightLayer = new OpenLayers.Layer.Vector("Highlighted Features", {
            displayInLayerSwitcher: false, 
            isBaseLayer: false 
            }
        );

        infoControls = {
            click: new OpenLayers.Control.WMSGetFeatureInfo({
                url: 'http://localhost:8080/geoserver/nurc/wms', 
                title: 'Identify features by clicking',
                layers: [bairros_cg, pontos],
                queryVisible: true
            })
            //hover: new OpenLayers.Control.WMSGetFeatureInfo({
            //    url: 'http://demo.boundlessgeo.com/geoserver/wms', 
            //    title: 'Identify features by clicking',
            //    layers: [water],
            //   hover: true,
                // defining a custom format options here
            //    formatOptions: {
            //        typeName: 'water_bodies', 
            //        featureNS: 'http://www.openplans.org/topp'
            //    },
            //    queryVisible: true
            //})
        };

		map.addLayers([osm]);

		map.addLayers([bairros_cg]);
		
		map.addLayers([pontos]);
		
		for (var i in infoControls) { 
            infoControls[i].events.register("getfeatureinfo", this, showInfo);
            map.addControl(infoControls[i]); 
        }

		//controles
		map.addControl(new OpenLayers.Control.LayerSwitcher());
		map.setCenter(new OpenLayers.LonLat(-36.8,-7.2).transform(new OpenLayers.Projection("EPSG:4326"), map.getProjectionObject()), 8);

		var click = new OpenLayers.Control.Click();
        map.addControl(click);
        click.activate();

      //  infoControls.click.activate();

	};

	function showInfo(evt) {
        if (evt.features && evt.features.length) {
             highlightLayer.destroyFeatures();
             highlightLayer.addFeatures(evt.features);
             highlightLayer.redraw();
        } else {
            document.getElementById('responseText').innerHTML = evt.text;
        }
    };

    function toggleControl(element) {
        for (var key in infoControls) {
            var control = infoControls[key];
            if (element.value == key && element.checked) {
                control.activate();
            } else {
                control.deactivate();
            }
        }
    };

    function toggleFormat(element) {
        for (var key in infoControls) {
            var control = infoControls[key];
            control.infoFormat = element.value;
        }
    }

    function toggleLayers(element) {
        for (var key in infoControls) {
            var control = infoControls[key];
            //if (element.value == 'Specified') {
                control.layers = [bairros_cg];
            //} else {
                //control.layers = null;
            //}
        }
    }

	</script>


	<body onload="init()">
		
		<div id="info">
	        <p>Click on the map to get feature info.</p>
	        
	        <div id="responseText">
	        </div>
	    
	    </div>		
     	
     	<div style="border:1px solid black; width:100%; height:100%" id="map"></div>

     	<ul id="control">
            
                <input name="controlType" id="click"
                       onclick="toggleControl(this);" checked="checked" />
            
        </ul>

        <ul id="layers">
            <li>
                <input type="radio" name="layerSelection" value="Specified" id="Specified"
                       onclick="toggleLayers(this);" checked="checked" />
                <label for="Specified">Get water body info</label>
            </li>
            <li>
                <input type="radio" name="layerSelection" value="Auto" id="Auto" 
                       onclick="toggleLayers(this);" />
                <label for="Auto">Get info for visible layers</label>
            </li>
        </ul>
    </body>

</html>
